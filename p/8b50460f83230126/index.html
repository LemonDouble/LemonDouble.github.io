<!doctype html><html lang=ko dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="\n이런 서비스를 만든 이야기를 합니다!\n2024.06.30 추가 : 당시는 ChatGPT가 나오기 전이라, 이런 챗봇 서비스가 흔하지 않던 때였습니다!\n"><title>Lemon Toolbox 첫 런칭 회고</title>
<link rel=canonical href=https://blog.lemondouble.com/p/8b50460f83230126/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="Lemon Toolbox 첫 런칭 회고"><meta property='og:description' content="\n이런 서비스를 만든 이야기를 합니다!\n2024.06.30 추가 : 당시는 ChatGPT가 나오기 전이라, 이런 챗봇 서비스가 흔하지 않던 때였습니다!\n"><meta property='og:url' content='https://blog.lemondouble.com/p/8b50460f83230126/'><meta property='og:site_name' content='Lemon Blog'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='서비스 회고'><meta property='article:published_time' content='2022-02-27T15:39:07+09:00'><meta property='article:modified_time' content='2022-02-27T15:39:07+09:00'><meta property='og:image' content='https://blog.lemondouble.com/p/8b50460f83230126/image-18.png'><meta name=twitter:site content="@https://blog.lemondouble.com"><meta name=twitter:creator content="@https://blog.lemondouble.com"><meta name=twitter:title content="Lemon Toolbox 첫 런칭 회고"><meta name=twitter:description content="\n이런 서비스를 만든 이야기를 합니다!\n2024.06.30 추가 : 당시는 ChatGPT가 나오기 전이라, 이런 챗봇 서비스가 흔하지 않던 때였습니다!\n"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://blog.lemondouble.com/p/8b50460f83230126/image-18.png'><link rel="shortcut icon" href=https://cdn.lemondouble.com/homepage/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-9C6YX68EBM"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9C6YX68EBM")</script><style>@import "https://cdnjs.cloudflare.com/ajax/libs/pretendard/1.3.9/static/pretendard.min.css";@import 'https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,500;1,500&display=swap';*{font-family:-apple-system,BlinkMacSystemFont,apple sd gothic neo,pretendard variable,Pretendard,Roboto,noto sans kr,segoe ui,malgun gothic,apple color emoji,segoe ui emoji,segoe ui symbol,sans-serif}</style></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="메뉴 여닫기">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_3c50f63a05989f65.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>⛱️</span></figure><div class=site-meta><h1 class=site-name><a href=/>Lemon Blog</a></h1><h2 class=site-description>이런저런 걸 합니다. 블로그 기고는 보통 제가 했던 일을 까먹지 않기 위해 합니다(..)</h2></div></header><ol class=menu-social><li><a href=https://github.com/LemonDouble target=_blank title=GitHub rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" class="icon icon-tabler icons-tabler-filled icon-tabler-brand-github"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5.315 2.1c.791-.113 1.9.145 3.333.966l.272.161.16.1.397-.083a13.3 13.3.0 014.59-.08l.456.08.396.083.161-.1c1.385-.84 2.487-1.17 3.322-1.148l.164.008.147.017.076.014.05.011.144.047a1 1 0 01.53.514 5.2 5.2.0 01.397 2.91l-.047.267-.046.196.123.163c.574.795.93 1.728 1.03 2.707l.023.295L21 9.5c0 3.855-1.659 5.883-4.644 6.68l-.245.061-.132.029.014.161.008.157.004.365-.002.213L16 21a1 1 0 01-.883.993L15 22H9a1 1 0 01-.993-.883L8 21v-.734c-1.818.26-3.03-.424-4.11-1.878l-.535-.766c-.28-.396-.455-.579-.589-.644l-.048-.019a1 1 0 01.564-1.918c.642.188 1.074.568 1.57 1.239l.538.769c.76 1.079 1.36 1.459 2.609 1.191L8 17.562l-.018-.168a5.03 5.03.0 01-.021-.824l.017-.185.019-.12-.108-.024c-2.976-.71-4.703-2.573-4.875-6.139l-.01-.31-.004-.292a5.6 5.6.0 01.908-3.051l.152-.222.122-.163-.045-.196a5.2 5.2.0 01.145-2.642l.1-.282.106-.253a1 1 0 01.529-.514l.144-.047.154-.03z"/></svg></a></li><li><a href=mailto:contact@lemondouble.com target=_blank title=mail rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" class="icon icon-tabler icons-tabler-filled icon-tabler-mail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 7.535V17a3 3 0 01-2.824 2.995L19 20H5a3 3 0 01-2.995-2.824L2 17V7.535l9.445 6.297.116.066a1 1 0 00.878.0l.116-.066 9.445-6.297z"/><path d="M19 4c1.08.0 2.027.57 2.555 1.427L12 11.797l-9.555-6.37a2.999 2.999.0 012.354-1.42L5 4h14z"/></svg></a></li><li><a href=https://sns.lemondouble.com/@lemondouble target=_blank title=misskey rel=me><svg class="bi" fill="currentcolor" viewBox="0 0 135.47 135.47"><g transform="translate(-38.1 -100.7)"><path d="m54.63 120.96c-1.9779.0-3.8618.32979-5.6513.98909-3.2023 1.1302-5.8396 3.1553-7.9117 6.0751-1.9779 2.8256-2.9667 5.9807-2.9667 9.4656v61.88c0 4.5209 1.601 8.4294 4.8033 11.726 3.2965 3.2023 7.2055 4.8038 11.726 4.8038 4.6151.0 8.5236-1.6015 11.726-4.8038 3.2965-3.2965 4.9449-7.205 4.9449-11.726v-11.253c.03556-2.4371 2.546-1.7977 3.8148.0 2.3763 4.1153 7.4142 7.6497 13.28 7.6295 5.8656-.0202 10.737-2.9202 13.28-7.6295.96304-1.1358 3.6774-3.071 3.9558.0v11.253c0 4.5209 1.601 8.4294 4.8033 11.726 3.2965 3.2023 7.2055 4.8038 11.726 4.8038 4.6151.0 8.5236-1.6015 11.726-4.8038 3.2965-3.2965 4.9449-7.205 4.9449-11.726v-61.88c0-3.4849-1.0357-6.64-3.1078-9.4656-1.9779-2.9198-4.5683-4.9448-7.7706-6.0751-1.8837-.6593-3.7676-.98909-5.6513-.98909-5.086.0-9.3712 1.9782-12.856 5.934l-16.775 19.632c-.37674.28256-1.6248 2.4428-4.2757 2.4428s-3.7574-2.1602-4.1341-2.4428l-16.916-19.632c-3.3907-3.9558-7.6289-5.934-12.715-5.934zm104.53.0c-3.9558.0-7.3464 1.4129-10.172 4.2385-2.7314 2.7314-4.0969 6.0751-4.0969 10.031.0 3.9558 1.3655 7.3464 4.0969 10.172 2.8256 2.7314 6.2162 4.0974 10.172 4.0974s7.3464-1.366 10.172-4.0974c2.8256-2.8256 4.2385-6.2162 4.2385-10.172s-1.4129-7.2995-4.2385-10.031c-2.8256-2.8256-6.2162-4.2385-10.172-4.2385zm.14107 31.364c-3.9558.0-7.3464 1.4129-10.172 4.2385s-4.238 6.2162-4.238 10.172v34.896c0 3.9558 1.4124 7.3464 4.238 10.172 2.8256 2.7314 6.2162 4.0974 10.172 4.0974s7.2995-1.366 10.031-4.0974c2.8256-2.8256 4.2385-6.2162 4.2385-10.172v-34.896c0-3.9558-1.4129-7.3464-4.2385-10.172-2.7314-2.8256-6.0751-4.2385-10.031-4.2385z"/></g></svg></a></li><li><a href=https://twitter.com/_lemon_berry_ target=_blank title=Twitter rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" class="icon icon-tabler icons-tabler-filled icon-tabler-brand-twitter"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14.058 3.41c-1.807.767-2.995 2.453-3.056 4.38L11 7.972l-.243-.023C8.365 7.68 6.259 6.437 4.813 4.418a1 1 0 00-1.685.092l-.097.186-.049.099c-.719 1.485-1.19 3.29-1.017 5.203l.03.273c.283 2.263 1.5 4.215 3.779 5.679l.173.107-.081.043c-1.315.663-2.518.952-3.827.9-1.056-.04-1.446 1.372-.518 1.878 3.598 1.961 7.461 2.566 10.792 1.6 4.06-1.18 7.152-4.223 8.335-8.433l.127-.495c.238-.993.372-2.006.401-3.024l.003-.332.393-.779.44-.862.214-.434.118-.247c.265-.565.456-1.033.574-1.43l.014-.056.008-.018c.22-.593-.166-1.358-.941-1.358l-.122.007a.997.997.0 00-.231.057l-.086.038a7.46 7.46.0 01-.88.36l-.356.115-.271.08-.772.214c-1.336-1.118-3.144-1.254-5.012-.554l-.211.084z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>홈</span></a></li><li><a href=/about/ target=_blank><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>프로필 (🔗)</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>보관함</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>검색</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>다크 모드</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">목차</h2><div class=widget--toc><nav id=TableOfContents><ol><li><ol><li><a href=#1-왜-이런걸-개발하게-됐나요>1. 왜 이런걸 개발하게 됐나요?</a></li><li><a href=#2-serverless-ml>2. Serverless ML?</a><ol><li><a href=#머신-러닝-변환된-데이터를-만드는-아주아주-간단한-구조는-다음과-같습니다>머신 러닝 변환된 데이터를 만드는 아주아주 간단한 구조는 다음과 같습니다.</a></li><li><a href=#아-문제가-해결됐네요-대충-이렇게-한번-해-보죠>아! 문제가 해결됐네요! 대충 이렇게 한번 해 보죠!</a></li></ol></li><li><a href=#3-녹록치-않은-현실>3. 녹록치 않은 현실</a></li><li><a href=#4-런칭---부제--bottleneck은-생각치-못한-곳에서-터진다>4. 런칭 - 부제 : Bottleneck은 생각치 못한 곳에서 터진다</a><ol><li><a href=#앗>앗!</a></li></ol></li><li><a href=#5-결론-및-후기>5. 결론 및 후기</a><ol><li><a href=#암튼-많이-힘들었는데-어떻게든-여차저차-넘긴-것-같아서-다행입니다>암튼.. 많이 힘들었는데 어떻게든 여차저차 넘긴 것 같아서 다행입니다!</a></li></ol></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/8b50460f83230126/><img src=/p/8b50460f83230126/image-18_hu_ed01c685df1a9e61.png srcset="/p/8b50460f83230126/image-18_hu_ed01c685df1a9e61.png 800w, /p/8b50460f83230126/image-18_hu_c822f5810df3a1a4.png 1600w" width=800 height=1419 loading=lazy alt="Featured image of post Lemon Toolbox 첫 런칭 회고"></a></div><div class=article-details><header class=article-category><a href=/categories/%EC%84%9C%EB%B9%84%EC%8A%A4-%ED%9A%8C%EA%B3%A0/>서비스 회고</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/8b50460f83230126/>Lemon Toolbox 첫 런칭 회고</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2022년 2월 27일</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>9 분 정도</time></div></footer></div></header><section class=article-content><p><img src=/p/8b50460f83230126/image-18.png width=300 height=532 srcset="/p/8b50460f83230126/image-18_hu_e4d557ce9a736b5f.png 480w, /p/8b50460f83230126/image-18_hu_aa2525ef9cc14290.png 1024w" loading=lazy alt="Lemon Toolbox 챗봇" class=gallery-image data-flex-grow=56 data-flex-basis=135px></p><blockquote><p>이런 서비스를 만든 이야기를 합니다!</p></blockquote><blockquote><p>2024.06.30 추가 : 당시는 ChatGPT가 나오기 전이라, 이런 챗봇 서비스가 흔하지 않던 때였습니다!</p></blockquote><p><img src=/p/8b50460f83230126/image.png width=583 height=684 srcset="/p/8b50460f83230126/image_hu_57801f5655e9bd6a.png 480w, /p/8b50460f83230126/image_hu_4b9baec4bede4ab7.png 1024w" loading=lazy alt="오픈 첫날 트위터 캡쳐" class=gallery-image data-flex-grow=85 data-flex-basis=204px></p><blockquote><p>으아아 도대체 무슨 일이 일어나고 있는 거에요!!</p></blockquote><h3 id=1-왜-이런걸-개발하게-됐나요>1. 왜 이런걸 개발하게 됐나요?</h3><p><del>원래 길게 뭔가 적었었는데, 남의 TMI는 별로 재미없을 것 같아 간단하게 적습니다. 근데 줄여도 꽤 기네요!</del></p><p>취미로 <a class=link href=https://wikidocs.net/book/2155 target=_blank rel=noopener>딥 러닝을 이용한 자연어 처리 입문</a>을 읽다, <a class=link href=https://wikidocs.net/154530 target=_blank rel=noopener>BERT의 문장 임베딩을 이용한 한국어 챗봇</a> 파트에서 Train Data를 트윗 기반으로 할 수 있을 것 같은데? 하는 생각이 문득 들었습니다.</p><p><img src=/p/8b50460f83230126/image-1.png width=388 height=178 srcset="/p/8b50460f83230126/image-1_hu_587a00c95b048073.png 480w, /p/8b50460f83230126/image-1_hu_41429eb0d09003c0.png 1024w" loading=lazy alt="책 예문" class=gallery-image data-flex-grow=217 data-flex-basis=523px></p><blockquote><p>어 이거.. 트위터 멘션으로도 비슷하게 할 수 있지 않을까?</p></blockquote><p><img src=/p/8b50460f83230126/image-2.png width=405 height=190 srcset="/p/8b50460f83230126/image-2_hu_de085797cd6bf941.png 480w, /p/8b50460f83230126/image-2_hu_e231e43696aaf807.png 1024w" loading=lazy alt=트윗 class=gallery-image data-flex-grow=213 data-flex-basis=511px></p><blockquote><p>이런 식으로 만들 수 있지 않을까?</p></blockquote><p>문제는 Train Data의 개수인데, Twitter API는 최근 트윗 요청 시, 최대 3200개까지밖에 트윗 데이터를 제공하지 않습니다.</p><p>보수적으로, 이 중 절반이 절반이 퍼블릭 트윗 (허공에 쓰는 트윗) 이라 가정하면 약 1600개의 트윗 정도가 Train Data가 되는데, 아시다시피 머신러닝에서 Train Data 1600개는 데이터의 양이 매우 작아 의미있는 챗봇을 만들기는 힘듭니다.</p><p><strong>하지만 재밌어 보이면 일단 해볼만한게 아닐까요?</strong></p><p>그래서 만들어 보기로 했습니다.
아&mldr; 그때는 몰랐습니다. 한 200라인쯤 되는 Colab 코드를 서비스로 만들기 위해 한달을 넘게 태우게 될 줄은&mldr;</p><h3 id=2-serverless-ml>2. Serverless ML?</h3><h4 id=머신-러닝-변환된-데이터를-만드는-아주아주-간단한-구조는-다음과-같습니다>머신 러닝 변환된 데이터를 만드는 아주아주 간단한 구조는 다음과 같습니다.</h4><p><img src=/p/8b50460f83230126/image-3.png width=1390 height=301 srcset="/p/8b50460f83230126/image-3_hu_48870cf6006c6710.png 480w, /p/8b50460f83230126/image-3_hu_45c38a5969f0732b.png 1024w" loading=lazy alt="서비스 파이프라인" class=gallery-image data-flex-grow=461 data-flex-basis=1108px></p><blockquote><p>즉, 그냥 서버 한대로 한번에 하나씩 처리하면, 한 사람 처리하는데 약 15분씩 걸립니다!</p></blockquote><p>그러면 대충 한시간당 4명 처리가 가능하네요!
100명이면 25시간,
1000명이 오면 250시간이니까&mldr;</p><p><strong>오늘 서비스를 등록하면 10일 뒤에 완료가 됩니다!</strong>
<del>심지어 이건 챗봇에서 질문/답변은 제외한 값입니다!</del></p><blockquote><p>아.. 이건 좀&mldr; 어떻게든 다른 방법을 생각해 봐야겠다&mldr;</p></blockquote><p>아! 생각해보니 Serverless 아키텍쳐를 쓰면 좋을 것 같습니다.
Serverless의 개념을 잘 모르시는 분도 계실테니, 간단히 그림을 통해 설명해 볼게요.</p><p><img src=/p/8b50460f83230126/image-4.png width=1460 height=1094 srcset="/p/8b50460f83230126/image-4_hu_ba994e17a7958938.png 480w, /p/8b50460f83230126/image-4_hu_d3f40000dd45cbca.png 1024w" loading=lazy alt="기존 VPS 사용 예시" class=gallery-image data-flex-grow=133 data-flex-basis=320px></p><blockquote><p>이게 기존 클라우드 사용 방식입니다. 한달, 일주일, 하루 등 정해진 기간만큼 컴퓨터를 빌리고, 빌린 시간만큼 돈을 냅니다. VPS라는 친구가 이거 비슷한 개념이에요!</p></blockquote><p><img src=/p/8b50460f83230126/image-5.png width=1689 height=1201 srcset="/p/8b50460f83230126/image-5_hu_78adb962fed60d40.png 480w, /p/8b50460f83230126/image-5_hu_b0a1b387f1ab0592.png 1024w" loading=lazy class=gallery-image data-flex-grow=140 data-flex-basis=337px></p><p><img src=/p/8b50460f83230126/image-6.png width=1699 height=1041 srcset="/p/8b50460f83230126/image-6_hu_c12bcad862aea9ba.png 480w, /p/8b50460f83230126/image-6_hu_9dd442f6299bc5ee.png 1024w" loading=lazy class=gallery-image data-flex-grow=163 data-flex-basis=391px></p><blockquote><p>이건 Serverless 방법입니다. 어떤 작업을 할 때 필요한 만큼 요청하면 딱 그 작업이 끝날 때 까지만 빌릴 수 있습니다.</p></blockquote><p>만약 동시에 사람이 100명이 들어온다면, 100개의 서버를 동시에 빌려서 처리할 수 있습니다.
만약 사람이 한 명도 안 들어온다면, 그 동안은 서버를 빌리지 않아도 됩니다.</p><p>이런 아키텍쳐를 적용한다면, 이론적으론 <strong>몇 명이 들어와도 한 명이 들어온것과 같은 속도</strong>로 데이터를 처리할 수 있습니다! <del>물론 실제로는 다른 문제들이 있긴 합니다.</del></p><h4 id=아-문제가-해결됐네요-대충-이렇게-한번-해-보죠>아! 문제가 해결됐네요! 대충 이렇게 한번 해 보죠!</h4><h3 id=3-녹록치-않은-현실>3. 녹록치 않은 현실</h3><p><img src=/p/8b50460f83230126/image-7.png width=1655 height=1127 srcset="/p/8b50460f83230126/image-7_hu_1a0b85aca0246d6a.png 480w, /p/8b50460f83230126/image-7_hu_fe899c8d9a1433b.png 1024w" loading=lazy alt="서비스 아키텍쳐 구성도" class=gallery-image data-flex-grow=146 data-flex-basis=352px></p><blockquote><p>대충 어떻게 하면 될 줄 알았는데&mldr;</p></blockquote><p>아&mldr;.
여러분도 갑자기 머리가 아프시죠?
이걸 아주아주 간단하게 줄이면 다음과 같습니다.</p><p><img src=/p/8b50460f83230126/image-8.png width=933 height=772 srcset="/p/8b50460f83230126/image-8_hu_8ff16bdc90da9c7.png 480w, /p/8b50460f83230126/image-8_hu_87f886c522a680b1.png 1024w" loading=lazy alt="간략화한 서비스 아키텍쳐 구성도" class=gallery-image data-flex-grow=120 data-flex-basis=290px></p><blockquote><p>아 이러니까 좀 이해가 되네요!</p></blockquote><p>핵심적인 부분은 다음과 같습니다.</p><ol><li>서버비를 아끼기 위해, 회원가입 / 인증 토큰 발급 등만 홈 서버의 Spring 서버가 처리</li><li>무거운 연산인 머신러닝은 클라우드(AWS)에 요청을 보내고, AWS 서버 자원을 활용해 처리.</li><li>AWS에서 처리 완료시 홈 서버에게 알려주고, 처리 완료 사실을 DB에 저장</li></ol><p>개인적으로 홈 서버를 사용하는 것이 있으니, 가벼운 연산은 홈 서버가 처리해 서버 임대료를 줄이고, 무거운 연산은 클라우드 서비스(AWS)에게 맡겨 <strong>가성비</strong>와 <strong>성능</strong>을 둘 다 잡겠다는 꿈과 희망을 가지고 서비스를 만들었습니다!</p><h3 id=4-런칭---부제--bottleneck은-생각치-못한-곳에서-터진다>4. 런칭 - 부제 : Bottleneck은 생각치 못한 곳에서 터진다</h3><p><img src=/p/8b50460f83230126/image-9.png width=586 height=1072 srcset="/p/8b50460f83230126/image-9_hu_c1ef9ba20fdbc9dc.png 480w, /p/8b50460f83230126/image-9_hu_bc4415c6d0202c8f.png 1024w" loading=lazy alt="오픈 첫날 장애 대응 트윗들" class=gallery-image data-flex-grow=54 data-flex-basis=131px></p><blockquote><p>죄송합니다.. 아니 그&mldr; 계획은 분명히 완벽했는데..</p></blockquote><p>당연히 이 프로젝트의 Bottleneck은 머신러닝 부분이 될 줄 알았고, 그에 맞춰 전체 시스템을 작성했는데 의외로.. 그렇지가 않았다.</p><p><img src=/p/8b50460f83230126/image-10.png width=1665 height=573 srcset="/p/8b50460f83230126/image-10_hu_32d83e167d465559.png 480w, /p/8b50460f83230126/image-10_hu_bbb90bb0b7629771.png 1024w" loading=lazy alt="SQS 모니터링 화면" class=gallery-image data-flex-grow=290 data-flex-basis=697px></p><p>삭제된 메세지 수는 처리량을 가늠할 수 있는 지표이다.
요청이 메세지 형태로 들어왔을 때, 1분동안 몇 개의 요청을 처리하고 요청(메세지)를 삭제했는가를 나타낸다.</p><p>보다시피, 트윗 3200개를 긁어오는 스크립트와 BERT로 머신러닝 처리를 하는 Queue는 비슷하게 움직이며 요청을 전부 소화한 것을 볼 수 있다 (1번, 2번 그래프).</p><p>하지만 모든 파이프라인 작업이 성공시 Spring에 처리가 완료되었음을 알리고, DB에 &ldquo;사용 가능&rdquo; field를 true로 바꿔주는 Queue(3번)가 처리량을 따라가지 못 하는 것을 볼 수 있다.</p><p><img src=/p/8b50460f83230126/image-11.png width=1563 height=537 srcset="/p/8b50460f83230126/image-11_hu_21b11bf31d41f69e.png 480w, /p/8b50460f83230126/image-11_hu_f3fa2a2e6e1c75ed.png 1024w" loading=lazy class=gallery-image data-flex-grow=291 data-flex-basis=698px></p><p>문제점은, 초기 아키텍쳐는 ServiceReadyQueue가 바로바로 처리되는 것을 가정했다는 것이다.</p><p>따라서 Train 완료시 트위터 알림(Serverless)과 Spring 알림이 동시에 가는데, 이 때 트위터 알림은 바로 가지만 DB 작성에는 지연이 걸린다.
즉, 알림을 받고 간 유저가 <strong>최대 33분동안</strong> &ldquo;사용할 수 없습니다!&rdquo; 화면을 봐야 하는 문제가 생겼다.</p><p>솔직히 여기서 고민을 좀 많이 했었다.</p><blockquote><p>아&mldr; 평생 못 받아볼 트래픽인데&mldr; 로그인 막을&mldr; 막아야겠지..? 30분씩 밀리는데..?</p></blockquote><p>Spring에서 분당 10개의 메세지를 Consume하므로, 서비스에 등록하는 유저가 6초당 한명 이하라면 bottleneck은 자동으로 해소되겠지만, 모니터링 결과 도저히 줄어드는 추세가 아니어서 일단 로그인을 막기로 했다.</p><p>기준은 명확했는데, <strong>처리가 늦게 되는 것</strong> 은 괜찮지만, <strong>처리가 되었다고 나왔는데 서비스를 사용할 수 없는 것</strong> 은 엄청나게 큰 결함이라고 생각했기 때문이다.</p><p>따라서, 일단 React 프로젝트에서 급하게 수정해 로그인 버튼과 서비스 등록 버튼을 떼고, 다음과 같이 파이프라인을 급하게 수정했다.</p><p><img src=/p/8b50460f83230126/image-12.png width=1203 height=358 srcset="/p/8b50460f83230126/image-12_hu_fa014db54047f5d2.png 480w, /p/8b50460f83230126/image-12_hu_6bff76bd0407885.png 1024w" loading=lazy alt="변경된 파이프라인" class=gallery-image data-flex-grow=336 data-flex-basis=806px></p><blockquote><p>이렇게 만든 경우, 처리속도엔 변함이 없지만 <strong>알림을 받고 왔는데 사용할 수 없는 경우</strong> 라는 크리티컬한 경우를 피할 수 있게 된다.</p></blockquote><p>이후 잠깐동안 DB 쓰기가 완료될 때 까지(밀린 작업이 처리될 떄까지) 시간을 가지고, 다시 로그인/등록 버튼을 살렸다.</p><p>이후, 생각한 대로 정상적으로 작동했다. 비록 Bottleneck 자체는 해결되지 못했지만, 적어도 <strong>완료 알림을 보고 온 사람이 몇십분간 서비스를 사용할 수 없는</strong> 크리티컬한 에러를 피했다.</p><p>그리고 모니터링을 하며 원인 분석을 하던 중, 메세지 처리량이 최대 10개에서 Fixed된 것을 보고, 관련 내용을 찾던 중 spring-cloud-aws의 issue에서 <a class=link href=https://github.com/spring-attic/spring-cloud-aws/issues/166 target=_blank rel=noopener>이런</a> issue를 찾을 수 있었다. 요약하자면, 한 번에 10개의 메세지만 처리할 수 있고, 비동기가 아니라 동기식으로 작동하는 문제가 있다는 것이다.</p><p>현재도 열려있는 다른 <a class=link href=https://github.com/awspring/spring-cloud-aws/issues/23 target=_blank rel=noopener>issue</a>를 보니, 해당 문제는 대대적인 리팩토링이 필요해 3.0.0에서 수정할 예정이라고 한다. 결론적으론..</p><blockquote><p>아&mldr; 그럼 핫픽스하긴 힘들겠네&mldr;</p></blockquote><p>결론적으로, Bottleneck 자체를 간단하게는 해결할 순 없고 이를 해결하기 위해선 Spring이 하는 일 자체도 Serverless 아키텍쳐로 재작성하거나, 라이브러리 의존성을 뜯어고치는 대공사(&mldr;) 를 해야 한다는 결론에 이르렀다. 뭐가 됐든, 런칭했는데 오늘 할 일은 아니니까 모니터링이나 좀 더 하기로 했다.</p><h4 id=앗>앗!</h4><p>이번엔 다른 Queue에 메세지가 쌓이기 시작했다. Tweet 3200개를 긁어오는 큐였다.
바로 모니터링에 들어갔고, 해당 Queue를 핸들링하는 Lambda 함수가 다음과 같이 Error Rate가 100%까지 올라가는 걸 볼 수 있 었다.</p><p><img src=/p/8b50460f83230126/image-13.png width=308 height=308 srcset="/p/8b50460f83230126/image-13_hu_f0bdcc828785091d.png 480w, /p/8b50460f83230126/image-13_hu_16e60cf373247962.png 1024w" loading=lazy alt="Error Late 100% 모니터링" class=gallery-image data-flex-grow=100 data-flex-basis=240px></p><blockquote><p>이건 보나마나 API 리밋이네!</p></blockquote><p>CloudWatch에 들어가서, 해당 Lambda Function의 로그를 까 보니 역시나였다.</p><p><img src=/p/8b50460f83230126/image-14.png width=303 height=38 srcset="/p/8b50460f83230126/image-14_hu_75c9ad87c08c9649.png 480w, /p/8b50460f83230126/image-14_hu_99e03ef448d35f02.png 1024w" loading=lazy alt="429 Error 로그" class=gallery-image data-flex-grow=797 data-flex-basis=1913px></p><blockquote><p>API 리밋 맞네!</p></blockquote><p>무슨 종류의 리밋인진 모르겠지만
<del>(트위터는 유저 리밋, 앱 리밋, 15분 리밋, 하루 리밋, 한달 리밋 등 아주 종류별로 제한이 있다..)</del>
서비스 등록 버튼을 빼야겠다는 것은 자명했다(..)
서비스 등록 버튼을 빼고, 트위터에 관련 공지를 올리고 나니 폭풍같은 3시간이 지나갔다.</p><p>일일 리밋을 먹어서 더이상 내가 할 수 있는 일이 없는고로(..) 서비스 부검을 하고 기록을 남기기로 해서, 지금 이걸 작성하고 있다.</p><h3 id=5-결론-및-후기>5. 결론 및 후기</h3><p>아&mldr; SQS -> Spring 으로 가는 곳이 Bottleneck이 될 줄도 몰랐고,
항상 꿈꿔왔지만 갑자기 많은 트래픽이 몰아쳐서 서버가 못 버틸 때, 패닉 상태가 오는 걸 처음 경험했던 것 같다.</p><p>특히, 서비스 전체를 내가 만들었으니(&mldr;) 장애 부분은 빠르게 찾았던 것 같은데, 라이브 서비스 중인 서비스를 어떻게 고칠 수 있을지? 사이드 이펙트는 어떻게 될지? 등을 고민하는게 가장 힘들었던 것 같다.</p><p>특히 중간처럼 <strong>&ldquo;서비스에 중대한 장애가 발생한 경우(알람은 왔는데 실행이 불가)&rdquo;</strong> 라이브 서버에서 빠르게 고쳐야 하는데, 급하게 작성한 코드가 어떤 Side Effect를 일으킬 줄 모르는 채로 급하게 핫픽스를 해야 하는게 심리적으로도 부담되고, 가장 떨리는 떄였던 것 같다.</p><p>솔직히 가장 크게 느낀 내용은</p><blockquote><p>아 이래서 자동화 테스트 자동화 테스트 하는구나&mldr;
테스트가 잔뜩 있었으면 만약 비슷한 경우가 생기더라도, 조금 더 마음 편하게 수정할 수 있겠구나</p></blockquote><p>하는 생각을 했었다.</p><p>그리고 의도하지 않았지만 AWS 덕을 크게 본 부분이 있는데(?)</p><p><img src=/p/8b50460f83230126/image-15.png width=926 height=737 srcset="/p/8b50460f83230126/image-15_hu_bd7de6c09cebbd67.png 480w, /p/8b50460f83230126/image-15_hu_297a37504a2d7264.png 1024w" loading=lazy alt="Queue 리스트" class=gallery-image data-flex-grow=125 data-flex-basis=301px></p><blockquote><ol><li>Queue 기반 아키텍쳐 사용을 통해 어떤 부분에서 병목이 발생하고, 에러가 발생하는지 빠르게 알 수 있었다.
만약 SQS를 사용하지 않았다면 Bottleneck을 찾는데 훨씬 많은 시간이 걸렸겠지만, Queue 기반 아키텍쳐를 사용한 덕분에 어떤 부분에서 병목이 나는지 쉽게 찾을 수 있었다.</li></ol></blockquote><p><img src=/p/8b50460f83230126/image-16.png width=495 height=585 srcset="/p/8b50460f83230126/image-16_hu_acb12bdafb3e3872.png 480w, /p/8b50460f83230126/image-16_hu_71718437acdf6a5d.png 1024w" loading=lazy alt="Cloudwatch 로그" class=gallery-image data-flex-grow=84 data-flex-basis=203px></p><blockquote><ol start=2><li>Cloudtrail 로그가 매우매우 편하고 중요하다는걸 깨달았다.
모니터링 시스템까지 구축하고 내놓으려다, 일단 한번 내 보고 반응 좋으면 더 개발하자(?) 라는 나이브한 마음가짐으로 일단 출시부터 해 봤었다.
하지만 역시나 문제가 생겼고, 개발 당시에 습관처럼 찍어놓은 상태 변화 및 Exception 출력 등이 에러 처리에 큰 도움이 되었다.
꼭 AWS 안 쓰더라도 로그를 잘 찍고, 로그 보는 법을 잘 알아두자..</li></ol></blockquote><p><img src=/p/8b50460f83230126/image-17.png width=958 height=70 srcset="/p/8b50460f83230126/image-17_hu_994ba6ab7d3b672c.png 480w, /p/8b50460f83230126/image-17_hu_50f8a6906310c87.png 1024w" loading=lazy alt=DLQ class=gallery-image data-flex-grow=1368 data-flex-basis=3284px></p><blockquote><ol start=3><li>DLQ 설정을 꼭 하자.
Poller(서비스 처리자)가 N번 이상 처리했는데도 Exception 등으로 처리가 안 된 메세지들은 DLQ(Dead Letter Queue)라는 곳에 모아놓을 수 있는데, DLQ를 활용하면 이후 DLQ 리드라이브라는 기능으로 처리되지 않은 메세지를 원래 큐로 돌려보낼 수 있다.
즉, 모종의 이유로 에러가 발생해서 처리되지 못 한 요청이 있다면 해당 요청은 DLQ로 가고, 이후 DLQ 리드라이브를 이용해 중단점부터 다시 처리할 수 있다!</li></ol></blockquote><h4 id=암튼-많이-힘들었는데-어떻게든-여차저차-넘긴-것-같아서-다행입니다>암튼.. 많이 힘들었는데 어떻게든 여차저차 넘긴 것 같아서 다행입니다!</h4><p>혹시 제가 잘못 알고 있는 부분이나, 개선할 수 있는 부분이 있다면 얼마든지 의견 남겨 주세요! 긴 글 읽어주셔서 정말 감사합니다!</p></section><footer class=article-footer><section class=article-tags><a href=/tags/%EC%84%9C%EB%B9%84%EC%8A%A4-%ED%9A%8C%EA%B3%A0/>서비스 회고</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><script src=https://giscus.app/client.js data-repo=LemonDouble/LemonDouble.github.io-comments data-repo-id=R_kgDOI0UkDA data-category=Comments data-category-id=DIC_kwDOI0UkDM4CcIeY data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark_dimmed")}})()</script><footer class=site-footer><section class=copyright>&copy;
2022 -
2025 Lemon Blog</section><section class=powerby>LemonDouble<br><a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a>로 만듦<br><a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>의 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> 테마 사용 중</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>